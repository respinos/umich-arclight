<html>
  <head>
    <%= render "arclight/fragments/utility_styles" %>
  </head>
  <body>

    <header>
      <div class="website-header-container">
        <a href="https://www.lib.umich.edu/">
          <span class="visually-hidden">University of Michigan Library</span>
          <svg viewBox="0 0 199 30" xmlns="http://www.w3.org/2000/svg" height="34px" width="224px" focusable="false" aria-hidden="true"><g fill="none" fill-rule="evenodd"><g fill-rule="nonzero"><polyline fill="#FFCB05" points="20.9572917 24.7441667 12.3733333 13.0122917 12.3733333 21.5458333 15.7866667 21.5458333 15.7866667 29.973125 0 29.973125 0 21.5458333 3.19875 21.5458333 3.19875 8.425625 0 8.425625 0 0 12.4010417 0 20.9572917 11.8164583 29.5135417 0 41.9116667 0 41.9116667 8.425625 38.7110417 8.425625 38.7110417 21.5458333 41.9116667 21.5458333 41.9116667 29.973125 26.1270833 29.973125 26.1270833 21.5458333 29.5377083 21.5458333 29.5377083 13.0122917 20.9572917 24.7441667"></polyline><polyline fill="#FFFFFF" points="58.6452083 30 58.6452083 0.0420833333 62.461875 0.0420833333 62.461875 26.680625 73.4579167 26.680625 73.4579167 30 58.6452083 30"></polyline><polygon fill="#FFFFFF" points="77.9570833 29.9875 81.773125 29.9875 81.773125 0.0420833333 77.9570833 0.0420833333"></polygon><path d="M91.0308333,26.680625 L96.425,26.680625 C100.491042,26.680625 101.944583,23.775625 101.944583,21.5777083 C101.944583,16.8052083 98.9972917,15.9754167 95.0983333,15.9754167 L91.0308333,15.9754167 L91.0308333,26.680625 Z M91.0308333,12.655625 L96.5916667,12.655625 C99.5779167,12.6139583 101.032083,10.7891667 101.032083,7.884375 C101.032083,5.395 99.6195833,3.36145833 96.425,3.36145833 L91.0308333,3.36145833 L91.0308333,12.655625 Z M87.2135417,30 L87.2135417,0.0420833333 L96.9652083,0.0420833333 C101.114375,0.0420833333 102.524792,1.4525 103.644792,3.11291667 C104.683542,4.73125 104.848958,6.51583333 104.848958,7.095625 C104.848958,10.83 103.562917,13.320625 99.7033333,14.1910417 L99.7033333,14.399375 C103.978333,14.8972917 105.844583,17.4695833 105.844583,21.5777083 C105.844583,29.2535417 100.242708,30 96.8402083,30 L87.2135417,30 Z" fill="#FFFFFF"></path><path d="M113.772708,12.9047917 L119.500625,12.9047917 C122.239792,12.9047917 123.5675,10.5397917 123.5675,7.925 C123.5675,5.76791667 122.485833,3.36145833 119.540625,3.36145833 L113.772708,3.36145833 L113.772708,12.9047917 Z M113.772708,16.2245833 L113.772708,30 L109.956458,30 L109.956458,0.0420833333 L120.28875,0.0420833333 C125.6,0.0420833333 127.465625,3.77729167 127.465625,7.51104167 C127.465625,11.0377083 125.515833,13.7347917 121.988125,14.3575 L121.988125,14.44 C125.431042,14.9795833 126.675417,16.14125 126.885,22.1570833 C126.927083,23.4435417 127.341042,28.1325 127.924167,30 L123.940833,30 C122.860417,27.9254167 123.108542,24.025625 122.777083,20.041875 C122.485833,16.3908333 119.540625,16.2245833 118.25625,16.2245833 L113.772708,16.2245833 Z" fill="#FFFFFF"></path><path d="M143.173333,3.56770833 L143.09,3.56770833 L138.401042,19.5439583 L147.989375,19.5439583 L143.173333,3.56770833 Z M140.848333,0.0420833333 L145.703958,0.0420833333 L155.45625,30 L151.181875,30 L149.025417,22.8620833 L137.448958,22.8620833 L135.207292,30 L131.349167,30 L140.848333,0.0420833333 Z" fill="#FFFFFF"></path><path d="M162.97875,12.9047917 L168.704583,12.9047917 C171.442292,12.9047917 172.769167,10.5397917 172.769167,7.925 C172.769167,5.76791667 171.69125,3.36145833 168.745625,3.36145833 L162.97875,3.36145833 L162.97875,12.9047917 Z M162.97875,16.2245833 L162.97875,30 L159.159375,30 L159.159375,0.0420833333 L169.491667,0.0420833333 C174.801667,0.0420833333 176.670625,3.77729167 176.670625,7.51104167 C176.670625,11.0377083 174.720208,13.7347917 171.192708,14.3575 L171.192708,14.44 C174.636458,14.9795833 175.881042,16.14125 176.087917,22.1570833 C176.1325,23.4435417 176.546458,28.1325 177.125833,30 L173.142083,30 C172.064583,27.9254167 172.314583,24.025625 171.981875,20.041875 C171.69125,16.3908333 168.745625,16.2245833 167.459583,16.2245833 L162.97875,16.2245833 Z" fill="#FFFFFF"></path><polyline fill="#FFFFFF" points="194.878958 0.0420833333 198.737917 0.0420833333 190.562708 18.5897917 190.562708 30 186.744583 30 186.744583 18.5897917 178.695208 0.0420833333 182.968542 0.0420833333 188.82 14.5227083 194.878958 0.0420833333"></polyline><polygon fill="#FFFFFF" points="50.1395834 29.9875 51.19625 29.9875 51.19625 0 50.1395834 0"></polygon></g></g></svg>
        </a>
        <a href="https://findingaid.lib.umich.edu/">Finding Aids</a>
      </div>
      <div class="repository">
        <a href="https://findingaids.lib.umich.edu/catalog?f%5Blevel_sim%5D%5B%5D=Collection&f%5Brepository_sim%5D%5B%5D=<%= @repository.name %>"><%= @repository.name %></a>
      </div>
    </header>

    <div id="toc"><ul></ul></div>

    <dl id="ead_author_block">
      <%= render 'arclight/fragments/dt_record', { label: 'Author', values: @collection.ead_author } %>
    </dl>


    <div class="al-contents-ish child-components">
      <%= render "arclight/fragments/components" %>
    </div>

    <div id="revdesc_changes">
    <% if @collection.revdesc_changes.present? %>
      <h3>Revision History</h3>
      <table class="table table-sm fs-7">
        <thead>
          <tr>
            <th>Date</th>
            <th>Item</th>
          </tr>
        </thead>
        <tbody>
          <% @collection.revdesc_changes.each do |change| %>
            <tr>
              <td style="white-space: nowrap"><%= change['date'] %></td>
              <td><%= change['item'] %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
    </div>

    <script id="toc-script">
      function build_toc_print(rootEl) {
        let isPrintable = document.documentElement.dataset.media == 'print'
        rootEl.dataset.tagName = isPrintable ? 'H2' : 'H3';
        let headings = isPrintable ? 
          [...document.querySelector('#content').querySelectorAll('h1,h2,h3,h4')] : 
          [...document.querySelectorAll('.al-contents-ish > article h3,.al-contents-ish > article h4')];

        if ( isPrintable ) {
          while ( headings.length && headings[0].tagName != 'H1' ) {
            headings.shift();
          }
          headings.shift(); /* the H1 */
        } else {
          rootEl.classList.add('nav');
        }

        let lastEl = headings[0]; let parents = [ rootEl ];

        let _add_link = function(el, elIdx) {
          if ( ! el.getAttribute("id") ) {
            el.setAttribute('id', `h${elIdx}`);
          }
          let linkEl = document.createElement('li');
          let anchorEl = document.createElement('a');
          if ( ! isPrintable ) {
            linkEl.classList.add('nav-item');
            anchorEl.classList.add('nav-link');
          }
          anchorEl.setAttribute('href', `#${el.getAttribute('id')}`);
          anchorEl.innerText = el.innerText.trim();
          linkEl.append(anchorEl);
          parents[0].append(linkEl);
          lastEl = el;
        }

        headings.forEach((el, elIdx) => {
          console.log("-- lastEl", lastEl.tagName, el.tagName);
          if ( lastEl.tagName == el.tagName ) {
            // we're at the same level
          } else if ( lastEl.tagName < el.tagName ) {
            // we're nesting
            let ulEl = document.createElement('ul'); ulEl.dataset.tagName = el.tagName;
            parents[0].querySelector(':scope > li:last-of-type').appendChild(ulEl);
            parents.unshift(ulEl);
          } else if ( lastEl.tagName > el.tagName ) {
            // we're bouncing out a level
            while ( parents.length && parents[0].dataset.tagName > el.tagName ) {
              parents.shift();
            }
          }
          _add_link(el, elIdx);
        })
      }

      let rootEl = document.querySelector('#toc > ul');
      if ( rootEl ) {
        build_toc_print(rootEl);
      }

    </script>

  </body>
</html>